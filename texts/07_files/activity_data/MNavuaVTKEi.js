/*1334542887,169776069*/

if (window.CavalryLogger) { CavalryLogger.start_js(["k0n\/L"]); }

var ReviewsApp={writeReview:false,writeReviewElem:null,ON_RATING_SET:'reviews/on_rating_set',ON_REVIEW_SUBMITTED:'reviews/on_review_submitted',IMAGE_STAR_ON:null,IMAGE_STAR_OFF:null,initialize:function(a,b){ReviewsApp.IMAGE_STAR_ON=a;ReviewsApp.IMAGE_STAR_OFF=b;var c=[a,b];for(var d=0;d<c.length;d++)(new Image()).src=c[d];}};function reviews_show_editor_inline(a){hide('review_editor_status');toggle(ge('reviews_inline_editor'));ReviewsApp.writeReviewElem=a;}function reviews_jump_to_and_open_editor(){var a=ge('reviews_inline_editor');if(a){show(a);$('review_blurb').focus();DOMScroll.scrollTo(a,true,true);}}function reviews_set_rating(a){var b=ge('review_rating');b.value=a;for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}Arbiter.inform(ReviewsApp.ON_RATING_SET,{element:b});return false;}function reviews_hover_rating(a){var b=ge('review_rating');if(!(b.value>0)){for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}}else return false;}function reviews_submit(a,b,c,d){if(c){new Dialog().setTitle(c).setBody(d).setModal(true).setButtons([Dialog.CLOSE]).show();return false;}var e=ge('review_blurb'),f=ge('review_rating'),g=Input.getValue(e),h=f.value,b=$('review_id').value;e.disabled=true;var i=(h<1)||(h>5);if(i){var j="You must choose a star rating",k=$('review_editor_error');DOM.setContent(k,HTML(j));show(k);e.disabled=false;return false;}else{var l=function(m){var n="Post successful.",o=$('review_editor_status');DOM.setContent(o,HTML(n));if(b>0){var p=ge('review_'+b);p.parentNode.removeChild(p);}var q=ge('new_review_container'),r=m.getPayload();if(r.reload)window.location.reload();if(r.oid)$('review_id').value=parseInt(r.oid);DOM.setContent(q,HTML(r.markup));show(o);setTimeout(function(){hide(o);},3000);hide('review_editor_error');hide('reviews_inline_editor');if(ReviewsApp.writeReview){if(ReviewsApp.writeReviewElem)DOM.setContent(ReviewsApp.writeReviewElem,HTML("Update Review"));ReviewsApp.writeReview=false;}};new AsyncRequest().setURI('/ajax/applications/reviews/inline/editor.php?of='+a).setData({review_id:b,rating:h,blurb:g}).setHandler(l).send();e.disabled=false;return true;}}
var EditAppSettings={currentTab:undefined,callbackUrl:'/ajax/edit_app_settings.php',statusElement:'edit_app_settings_save_fill',profileHandler:bagofholding,extendedHandler:bagofholding,appID:0,setup:function(a,b,c){this.appID=a;this.profileID=b;this.currentTab=c;return this;},_getCurrentTab:function(){if(!this.currentTab){var a=['profile','bookmark','extended'];for(var b=0;b<a.length;b++)if(ge(this._getTabId(a[b]))){this.currentTab=a[b];break;}}return this.currentTab;},_getTabId:function(a){return a+'_tab_link';},setupHandlers:function(a){this.profileHandler=a.profile||bagofholding;this.extendedHandler=a.extended||bagofholding;},switchTab:function(a){CSS.removeClass(this._getTabId(this._getCurrentTab()),'tab_link_selected');hide('app_settings_'+this._getCurrentTab()+'_tab');CSS.addClass(this._getTabId(a),'tab_link_selected');show('app_settings_'+a+'_tab');this.currentTab=a;},isUiMode:function(){return Dialog.getCurrent();},setExtendedPermission:function(a,b){var c=ge('explanation_'+a);if(c)(b?hide:show)(c);var d=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.extendedHandler.bind(this,this.appID,a)).setData({extended:1,permission:a,allow:b,profile_id:this.profileID,app_id:this.appID});if(this.isUiMode())d.setStatusElement(this.statusElement);d.send();return true;},makeProfileChange:function(a){var b=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.profileHandler.bind(this,this.appID)).setData({profile:1,item:'tab',action:a,app_id:this.appID,profile_id:this.profileID});if(this.isUiMode())b.setStatusElement(this.statusElement);b.send();if(this.isUiMode()){toggleDisplayNone('app_settings_profile_tab_add');toggleDisplayNone('app_settings_profile_tab_remove');CSS.toggleClass($('profile_tab_name_changer'),'hidden_elem');}},removeApplication:function(a){var b=a||bagofholding,c={remove:1,app_id:this.appID,profile_id:this.profileID};new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData(c).send();},blockApplication:function(a){var b=a||bagofholding;new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData({block:1,app_id:this.appID,profile_id:this.profileID}).send();},setBlockComposer:function(a,b){new AsyncRequest().setURI(this.callbackUrl).setHandler(b||bagofholding).setData({composer:1,blocked_composer:a,profile_id:this.profileID,app_id:this.appID}).send();},reviveComposerDialog:function(a,b){var c=tx._("Unblock {app-name} Publisher?",{'app-name':htmlize(a)}),d='<p>'+"Are you sure you want to allow this application's publisher on your profile? "+'</p>',e="Unblock";new Dialog().setTitle(c).setBody(d).setButtons([{name:'remove',label:e},Dialog.CANCEL]).setHandler(this.setBlockComposer.bind(this,0,b)).show();}};
function chain(a,b){var c,d=[];for(var e=0;e<arguments.length;e++)d.push(arguments[e]);c=function(event){event=event||window.event;for(var f=0;f<d.length;f++)if(d[f]&&d[f].apply(this,arguments)===false){return false;}else if(event&&event.cancelBubble)return true;return true;};c.toString=function(){return chain._toString(d);};return c;}if(!chain._toString)chain._toString=function(a){var b='chained fns';for(var c=0;c<a.length;c++)b+='\n'+a[c].toString();return b;};
function dropmenu(a){if(this==window){return new dropmenu(a);}else{this.className=null;this.menu=null;this.menuClickArea=null;this.showHandler=null;this.hideHandler=null;this.alignment=null;this.direction=null;this.isShown=false;this.canHide=false;this.show_hooks=[];this.hide_hooks=[];this.clickTarget=$(a);this.displayTarget=$(a);this.id=null;this.rtl=false;this._clickToHide=true;this._markupContentCallback=bagofholding;this.clickHandle=Event.listen(this.clickTarget,'click',this.toggle.bind(this));this.container=ge('dropmenu_container')||this.createContainer();return this;}}dropmenu.ALIGN_RIGHT=1;dropmenu.ALIGN_LEFT=2;dropmenu.DIRECTION_UP=3;dropmenu.DIRECTION_DOWN=4;dropmenu.INSTANCES={};dropmenu.prototype.createContainer=function(){var a=$N('div',{id:'dropmenu_container'});DOM.appendContent(DOM.getDocumentBodyElement(),a);return a;};dropmenu.prototype.setPosition=function(a){this.alignment=a;return this;};dropmenu.prototype.setDirection=function(a){this.direction=a;return this;};dropmenu.prototype.setMenuClickArea=function(a){this.menuClickArea=$(a);return this;};dropmenu.prototype.setDisplayTarget=function(a){this.displayTarget=$(a);return this;};dropmenu.prototype.setClickToHide=function(a){this._clickToHide=a;return this;};dropmenu.prototype.setMarkupContent=function(a,b,c){this.menuContent=c;this.className=b;this.id=a;return this;};dropmenu.prototype.setMarkupContentCallback=function(a){this._markupContentCallback=a;return this;};dropmenu.prototype._getMarkupContent=function(){return this.menuContent||this._markupContentCallback();};dropmenu.prototype.registerHTMLMenu=function(a){this.registered_menu_id=a;return this;};dropmenu.prototype.addHook=function(a,b){this[a+'_hooks'].push(b);return this;};dropmenu.prototype.removeHook=function(a,b){for(var c=0;c<this[a+'_hooks'].length;c++)if(b==this[a+'_hooks'][c]){this[a+'_hooks'].splice(c,1);return true;}return this;};dropmenu.prototype.toggle=function(a){if(!this.isShown){this._show();this.canHide=false;}else this._hide();$E(a).prevent();};dropmenu.prototype.show=function(){this._show();};dropmenu.prototype.hide=function(){if(!this.menu)return;this._hide();};dropmenu.prototype.destroy=function(){if(this.menu&&this.menu.parentNode){this.menu.parentNode.removeChild(this.menu);this.menu=null;}};dropmenu.prototype._buildMenu=function(){if(intl_locale_is_rtl()&&!this.rtl){this.alignment=(this.alignment==dropmenu.ALIGN_RIGHT)?dropmenu.ALIGN_LEFT:dropmenu.ALIGN_RIGHT;this.rtl=true;}if(this.registered_menu_id){this.menu=$(this.registered_menu_id);if(this.alignment||this.direction)this.container.appendChild(this.menu);}else this._buildDynamicMenu();dropmenu.INSTANCES[this.id]=this;this.menuClickArea=this.menuClickArea||DOM.scry(this.menu,'div.menu_content');this.menuClickArea.onclick=chain(this.menuClickArea.onclick,Event.stop);var a=DOM.scry(this.menu,'a');for(var b=0;b<a.length;b++)Event.listen(a[b],'click',function(){if(this._clickToHide)this._hide();}.bind(this));};dropmenu.prototype._buildDynamicMenu=function(){this.menu=document.createElement('div');this.menu.className='dropdown_menu hidden_elem '+(this.className?' '+this.className:'');this.menu.id='dropdown_menu_'+this.id;var a=this._getMarkupContent();if(!is_scalar(a)){DOM.setContent(this.menu,a);}else DOM.setContent(this.menu,HTML(a));this.container.appendChild(this.menu);};dropmenu.prototype._positionMenu=function(){if(this.alignment||this.direction||(!this.alignment&&!this.direction&&!this.registered_menu_id)){if(this.menu.parentNode!=this.container)this.container.appendChild(this.menu);var a=Vector2.getElementPosition(this.displayTarget,'document'),b=Vector2.getElementPosition(this.container,'document'),c=a.x-b.x,d=a.y-b.y+this.displayTarget.offsetHeight;if(this.alignment==dropmenu.ALIGN_RIGHT||this.direction==dropmenu.DIRECTION_UP){CSS.show(this.menu);this.menu.style.left='-9999px';this.menu.style.top='-9999px';if(this.alignment==dropmenu.ALIGN_RIGHT){var e=this.menu.offsetWidth;c=c+this.displayTarget.offsetWidth-e;}if(this.direction==dropmenu.DIRECTION_UP){var f=this.menu.offsetHeight;d=d-this.displayTarget.offsetHeight-f+1;}CSS.hide(this.menu);}this.menu.style.left=c+'px';this.menu.style.top=d+'px';}};dropmenu.prototype._onclick=function(event){this._hide();return false;};dropmenu.prototype._show=function(){if(!this.menu)this._buildMenu();this._positionMenu();CSS.show(this.menu);var a=this._documentHideHandler.bind(this);this.click_event=Event.listen(document.body,'click',a);onbeforeunloadRegister(a);this.isShown=true;for(var b=0;b<this.show_hooks.length;b++)this.show_hooks[b]();};dropmenu.prototype._documentHideHandler=function(a){if(!this.canHide){this.canHide=true;}else this._hide();};dropmenu.prototype._hide=function(){if(this.menu)CSS.hide(this.menu);if(this.click_event)this.click_event.remove();this.click_event=null;this.isShown=false;for(var a=0;a<this.hide_hooks.length;a++)this.hide_hooks[a]();if(!this.registered_menu_id)this.destroy();};dropmenu.prototype._build_menu_shim=function(){this.shim=null;if(ua.ie()<7){this.shim=document.createElement('iframe');CSS.setClass(shim,'iframe_shim');this.container.appendChild(this.shim);}};dropmenu.getExistingInstance=function(a){return dropmenu.INSTANCES[a];};
__d("isEmail",[],function(a,b,c,d,e,f){function g(h){return (/^([\w!.%+\-])+@([\w\-])+(?:\.[\w\-]+)+$/).test(h);}e.exports=g;});
__d("legacy:string-misc",["htmlHyperlink","isEmail"],function(a,b,c,d){a.html_hyperlink=b('htmlHyperlink');a.is_email=b('isEmail');},3);
var EditAppsController={BOOKMARKS_VIEW:'bookmarks',currentView:'',sortableGroup:null,ownedApps:null,init:function(a,b){this.profileID=a;this.ownedApps=b;EditAppSettings.setupHandlers({profile:this.changeProfileCallback,extended:this.setExtendedPermissionCallback});},setView:function(a){this.currentView=a;},switchView:function(a){goURI(new URI('/editapps.php').addQueryData({v:a}).toString());},changeProfileCallback:function(a){if(ge('editapps_tab_'+a)){toggleDisplayNone('editapps_tab_'+a);toggleDisplayNone('editapps_tab_'+a+'_undo');}},removeAppSuccessDialog:function(a,b,c){var d="Application Removed",e=tx._("You have removed \"{application-name}\".",{'application-name':b});new Dialog().setTitle(d).setBody(e).setButtons([Dialog.OK]).setHandler(a.bind(this,c)).show();},removeApplication:function(a,b,c){var d=htmlize(b),e=tx._("Remove {application-name}?",{'application-name':d}),f='<a href="/?sk=apps">'+"Apps Page"+'</a>',g='<p>'+tx._("If you remove {application-name}, it will be taken off your timeline, bookmarks and from the list of apps you use in your settings. You can also block apps to prevent them from accessing the non-public information you share with others who use them.",{'application-name':d,'applications-link':f})+'</p>';g+='<input type="hidden" name="remove_appId" value="'+a+'" />';var h={name:'remove',label:"Remove"},i=[h,Dialog.CANCEL];g='<div class="remove_application_dialog">'+g+'</div>';new Dialog().setTitle(e).setBody(g).setButtons(i).setModal(true).setHandler(function(){EditAppSettings.setup(a,this.profileID).removeApplication(c);}).show();return false;},removeExtendedPermission:function(a,b){this.setExtendedPermission(a,b,false);},undoRemoveExtendedPermission:function(a,b){this.setExtendedPermission(a,b,true);},setExtendedPermission:function(a,b,c){EditAppSettings.setup(a,this.profileID).setExtendedPermission(b,c);return true;},setExtendedPermissionCallback:function(a,b){toggleDisplayNone('editapps_extperm_'+b+'_'+a);toggleDisplayNone('editapps_extperm_'+b+'_'+a+'_undo');},addSortable:function(a){var b=$('editapps_bookmarked_wrapper_'+a);this.sortableGroup.addSortable(a,b);}};
__d("FormMonitor",["event-extensions","Arbiter","ArbiterMixin","Class","DOM","Form","ObjectUtils"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("ArbiterMixin"),i=b("Class"),j=b("DOM"),k=b("Form"),l=b("ObjectUtils");function m(n){this.form=n;this.clean=true;this.originalState=k.serialize(n);var o=this.onFormChange.bind(this);Event.listen(n,{keyup:o,click:o,paste:o,change:o,submit:this.onFormSubmit.bind(this)});g.subscribe('Form/change',function(p,q){j.contains(this.form,q.node)&&this.handleChange();}.bind(this));}i.mixin(m,h,{onFormSubmit:function(event){this.originalState=k.serialize(this.form);this.clean=true;this.inform('clean');},onFormChange:function(event){if(j.isNodeOfType(event.getTarget(),['input','select','textarea']))this.handleChange();},handleChange:function(){this.inform('change');var n=!l.areEqual(k.serialize(this.form),this.originalState);if(this.clean&&n){this.clean=false;this.inform('dirty');}else if(!this.clean&&!n){this.clean=true;this.inform('clean');}}});e.exports=m;});
__d("legacy:form-monitor",["FormMonitor"],function(a,b,c,d){a.FormMonitor=b('FormMonitor');},3);
function Collection(a,b){if(!a.__collection__){var c=new Function();for(var d in a.prototype)c.prototype[d]=Collection._call.bind(null,d);a.__collection__=c;}var e=new a.__collection__();e._elements=b;return e;}Collection._call=function(a){var b=Array.prototype.slice.call(arguments,1);this._elements.each(function(c){c[a].apply(c,b);});return this;};
function Scroller(a){this.canvas=a;this.scrollZone=50;this.velocity=100;this.coefficient=1;}Scroller.findScrollParent=function(a){var b;a=a.parentNode;while(a){if(a.scrollHeight!=a.offsetTop){b=CSS.getStyle(a,'overflowY');if(b=='scroll'||b=='auto')return a;}a=a.parentNode;}return document.body;};Scroller.prototype.activate=function(){this.activate=bagofholding;this.event=Event.listen(document,'mousemove',this._onmousemove.bind(this));this.interval=setInterval(this._intervalHandler.bind(this),50);this.cursor=null;};Scroller.prototype.deactivate=function(){delete this.activate;this.event&&this.event.remove();this.event=null;clearInterval(this.interval);};Scroller.prototype._onmousemove=function(event){this.cursor=new Vector2.getEventPosition(event);};Scroller.prototype._intervalHandler=function(){if(!this.cursor)return;var a=this.canvas==document.body?Rect.getViewportBounds():new Rect(this.canvas),b=new Rect(this.cursor.y-a.t,a.r-this.cursor.x,a.b-this.cursor.y,this.cursor.x-a.l),c=new Vector2(0,0);if(b.t<b.b&&b.t<this.scrollZone){c.y=-this.scrollZone+b.t;}else if(b.b<this.scrollZone)c.y=this.scrollZone-b.b;c.y=this._doMath(c.y);if(b.l<b.r&&b.l<this.scrollZone){c.x=-this.scrollZone+b.l;}else if(b.r<this.scrollZone)c.x=this.scrollZone-b.r;c.x=this._doMath(c.x);if(c.x||c.y){c.scrollElementBy(this.canvas);if(document.body==this.canvas)this.cursor=this.cursor.add(c);Arbiter.inform('scroller/scroll',this.cursor);}};Scroller.prototype._doMath=function(a){a=(a>=0?Math.min(a,this.scrollZone):Math.max(a,-this.scrollZone));return Math.floor(Math.pow(a/this.scrollZone*this.velocity,this.coefficient));};
var Drag={};Drag.currentDraggable=null;Drag.grab=function(a){if(Drag.currentDraggable)Drag._onmouseup();a.lastDragOver=null;Drag.attachDragEvents();Drag.currentDraggable=a;};Drag.attachDragEvents=function(){document.onselectstart=function(){document.onselectstart=null;return false;};if(Drag.dragEventsAttached)return;Drag.dragEventsAttached=true;Arbiter.subscribe('scroller/scroll',Drag._onmousemove);Event.listen(document,{mousemove:Drag._onmousemove,mouseup:Drag._onmouseup});};Drag.droppables={};Drag.addDroppable=function(a,b){(Drag.droppables[a]=Drag.droppables[a]||[]).push(b);};Drag.removeDroppable=function(a,b){Drag.droppables[a]=Drag.droppables[a].filter(function(c){return c!=b;});};Drag.getOffsetParent=function(a){if(DOM.isNodeOfType(a,['body','html']))return document.body;while((a=a.parentNode)&&a!==document.body)if(CSS.getStyle(a,'position')!=='static')return a;return document.body;};Drag._onmousemove=function(event,a){if(!Drag.currentDraggable)return;var b=a||Vector2.getEventPosition(event),c=Drag.currentDraggable,d=Drag.droppables[c.namespace];if(c.namespace&&c.active&&d){var e={};d.each(function(k){e[k.zIndex]=k.zIndex;});var f=[];for(var g in e)f.push(e[g]);f.sort();var h=c.lastDragOver,i=null;for(var j=f.length-1;j>=0;j--)if(h&&h.dom!=null&&h.zIndex==f[j]&&h.pointInside(b)){i=h;break;}else for(var g=0;g<d.length;g++){if(f[j]!=d[g].zIndex)continue;if(h!=d[g]&&c.dom!=d[g].dom&&d[g].pointInside(b)){i=d[g];j=-1;break;}}if(i&&i!=h){i.ondragover(c);Drag.currentDraggable.adjustCursorPosition();}if(i)i.ondragmove(c,b.sub(Vector2.getElementPosition(i.dom)));c.lastDragOver=i;}Drag.currentDraggable._onmousemove(b);};Drag._onmouseup=function(a){document.onselectstart=null;if(Drag.currentDraggable){Drag.currentDraggable._ondrop();Drag.currentDraggable=null;}};function Draggable(a){if(!a)throw new Error('Element should be a DOM node');if(!(this instanceof Draggable)){if(a instanceof Array){var b=[];a.each(function(c){b.push(new Draggable(c));});return new Collection(Draggable,b);}else return new Draggable(a);}else{this.data={};this.handles=[];this.dom=a;this.boundingBox=null;this.useScroller=true;this.grabPctX=this.grabPctY=0;this.addHandle(this.dom);}}Draggable.prototype.destroy=function(){this.handles.each(function(a){this.removeHandle(a.obj);}.bind(this));this.data=this.dom=null;};Draggable.prototype.adjustCursorPosition=function(){var a=Vector2.getElementDimensions(this.dom);this.cursorPositionVector=new Vector2(parseInt(this.grabPctX*a.x,10),parseInt(this.grabPctY*a.y,10));};Draggable.prototype._onclick=function(event){if(this.active)return Event.kill(event);};Draggable.prototype._ongrab=function(a){this.ongrab();if(this.useScroller){if(!this.scroller)this.scroller=new Scroller(Scroller.findScrollParent(this.dom));this.scroller.activate();}if(this.active){if(!this.oldPosition)this.oldPosition=this.dom.style.position;this.dom.style.position=this.absolute?'absolute':'relative';a.sub(this.cursorPositionVector).setElementPosition(this.dom);}};Draggable.prototype._onmousedown=function(event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var a=$E(event).getTarget();if(DOM.isNodeOfType(a,['input','select','textarea','object','embed']))return true;var b=Vector2.getEventPosition(event),c=Vector2.getElementDimensions(this.dom);this.draggableInitialVector=Vector2.getElementPosition(this.dom);this.cursorPositionVector=b.sub(this.draggableInitialVector);this.grabPctX=c.x===0?0:this.cursorPositionVector.x/c.x;this.grabPctY=c.y===0?0:this.cursorPositionVector.y/c.y;Drag.grab(this,event);if(this.gutter){this.cursorInitialVector=b;}else{this._setActive(true);this._ongrab(b);}return Event.kill(event);};Draggable.prototype._onmousemove=function(a){if(!this.active)if(a.distanceTo(this.cursorInitialVector)>=this.gutter){this._setActive(true);this._ongrab(a);}if(this.active){var b=a.sub(this.cursorPositionVector),c;if(this.boundingBox){var d=Rect.newFromVectors(b,Vector2.getElementDimensions(this.dom));d=d.boundWithin(this.boundingBox);b=d.getPositionVector();if(this.boundingBox.w()==0){c=new Vector2(this.draggableInitialVector.x,b.y,'document');}else if(this.boundingBox.h()==0){c=new Vector2(b.x,this.draggableInitialVector.y,'document');}else c=b;}else c=b;var e=Drag.getOffsetParent(this.dom);if(e!==document.body)c=c.sub(Vector2.getElementPosition(e));c.setElementPosition(this.dom);this.ondrag(a);}};Draggable.prototype._ondrop=function(){this.scroller&&this.scroller.deactivate();if(this.active){(function(){this._setActive(false);}).bind(this).defer();this.ondrop();if(this.lastDragOver)this.lastDragOver.ondrop(this);}};Draggable.prototype.killDrag=function(){this._setActive(false);Drag._onmouseup();};Draggable.prototype.setBoundingBox=function(a){this.boundingBox=a;return this;};Draggable.prototype.resetPosition=function(){this.dom.style.position=this.oldPosition;this.oldPosition=null;this.dom.style.left='';this.dom.style.top='';return this;};Draggable.prototype.setUseAbsolute=function(a){this.absolute=a;return this;};Draggable.prototype.ondrag=bagofholding;Draggable.prototype.setDragHandler=function(a){this.ondrag=a;return this;};Draggable.prototype.ongrab=bagofholding;Draggable.prototype.setGrabHandler=function(a){this.ongrab=a;return this;};Draggable.prototype.ondrop=bagofholding;Draggable.prototype.setDropHandler=function(a){this.ondrop=a;return this;};Draggable.prototype.gutter=0;Draggable.prototype.setGutter=function(a){this.gutter=a;return this;};Draggable.prototype.setNamespace=function(a){this.namespace=a;return this;};Draggable.prototype.setUseScroller=function(a){this.useScroller=a;return this;};Draggable.prototype.handles=null;Draggable.prototype.addHandle=function(a){if(this.handles.length==1&&this.handles[0].obj==this.dom)this.removeHandle(this.dom);this.handles.push({obj:a,evt:[Event.listen(a,'mousedown',this._onmousedown.bind(this)),Event.listen(a,'click',this._onclick.bind(this)),Event.listen(a,'drag',Event.kill),Event.listen(a,'selectstart',Event.kill)]});return this;};Draggable.prototype.removeHandle=function(a){this.handles=this.handles.filter(function(b){if(b.obj!=a){return true;}else{b.evt.each(function(c){c.remove();});return false;}});};Draggable.prototype.getDOM=function(){return this.dom;};Draggable.prototype.setKey=function(a,b){this.data[a]=b;return this;};Draggable.prototype.getKey=function(a){return this.data[a];};Draggable.prototype._setActive=function(a){this.dom.activeDrag=this.active=a;for(var b=0;b<this.handles.length;b++)this.handles[b].obj.activeDrag=a;};function Droppable(a){if(!a)throw new Error('Element should be a DOM node');if(!(this instanceof Droppable)){if(a instanceof Array){var b=[];a.each(function(c){b.push(new Droppable(c));});return new Collection(Droppable,b);}else return new Droppable(a);}else{this.data={};this.dom=a;this.namespace=null;}}Droppable.prototype.destroy=function(){if(this.namespace)Drag.removeDroppable(this.namespace,this);this.data=this.dom=null;};Droppable.prototype.setNamespace=function(a){if(this.namespace)Drag.removeDroppable(this.namespace,this);this.namespace=a;Drag.addDroppable(a,this);return this;};Droppable.prototype.zIndex=0;Droppable.prototype.setZIndex=function(a){this.zIndex=a;return this;};Droppable.prototype.pointInside=function(a){var b=Vector2.getElementPosition(this.dom);return b.x<=a.x&&this.dom.offsetWidth+b.x>a.x&&b.y<=a.y&&this.dom.offsetHeight+b.y>a.y;};Droppable.prototype.ondragover=bagofholding;Droppable.prototype.setDragOverHandler=function(a){this.ondragover=a;return this;};Droppable.prototype.ondragmove=bagofholding;Droppable.prototype.setDragMoveHandler=function(a){this.ondragmove=a;return this;};Droppable.prototype.ondrop=bagofholding;Droppable.prototype.setDropHandler=function(a){this.ondrop=a;return this;};Droppable.prototype.getDOM=Draggable.prototype.getDOM;Droppable.prototype.setKey=Draggable.prototype.setKey;Droppable.prototype.getKey=Draggable.prototype.getKey;
function SortableGroup(){this.namespace='sortable'+(++SortableGroup.instanceCount);this.draggables={};this.droppables={};this.sortables={};this.linkedGroups=[];this.linkedGroups.onbeforelinkjump=bagofholding;this.linkedGroups.onlinkjump=bagofholding;this.rootNode=null;this.boundingBox=null;this.neverEmpty=false;this.hasEmptyMessage=false;this.isDroppable=true;this.isDraggable=true;this.requireSameParent=true;this.anchor=null;this.disabled=false;}SortableGroup.instanceCount=0;copy_properties(SortableGroup.prototype,{gutter:15,onbeforegrabcallback:bagofholding,onbeforedragover:bagofholding,ondragover:bagofholding,ondropcallback:bagofholding,ongrabcallback:bagofholding,onorderchange:bagofholding,addEmptyMessage:function(a,b){var c='placeholder';if(a.parentNode!=b)DOM.appendContent(b,a);this.emptyMessage=a;this._initializeAdded(c,a);this.hasEmptyMessage=true;this.sortables[c]=a;this.droppables[c]=(new Droppable(a)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,c));return this;},removeEmptyMessage:function(){if(this.emptyMessage)DOM.remove(this.emptyMessage);this.hasEmptyMessage=false;this.removeSortable('placeholder');return this;},addSortable:function(a,b,c){this._initializeAdded(a,b);this.sortables[a]=b;this.draggables[a]=(new Draggable(b)).setNamespace(this.namespace).setGutter(this.gutter).setUseAbsolute(true).setGrabHandler(this.grabHandler.bind(this,a)).setDropHandler(this.dropHandler.bind(this,a)).setKey('key',a).setBoundingBox(this.boundingBox);if(c)this.draggables[a].addHandle(c);this.droppables[a]=(new Droppable(b)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,a));return this;},destroy:function(){for(var a in this.droppables)this.droppables[a].destroy();for(var b in this.draggables)this.draggables[b].destroy();this.droppables=this.draggables=this.rootNode=null;this.linkedGroups.remove(this);for(var c=0;c<this.linkedGroups.length;c++)this.linkedGroups[c].linkedGroups=this.linkedGroups;},dragOverHandler:function(a,b){if(!this.isDroppable&&!this.anchor)return;var c=false;if(!(b in this.draggables)){this.linkedGroups.onbeforelinkjump.call(this,b);if(!this.migrateLinkedSortable(b))throw new Error('Draggable dropped onto a foreign droppable!');c=true;}var d=true,e=this.getSortables(),f=this.sortables[b],g=this.sortables[a];if(!this.anchor){var h=e.length;for(var i=0;i<h;i++)if(e[i]==g){break;}else if(e[i]==f){d=false;break;}}else g=this.anchor;this.onbeforedragover(f,g);var j=this.linkedGroups.placeholder;this.insertPlaceholder(j,g,d||this.anchor);j.parentNode.insertBefore(f,j);this.ondragover(f,g);if(c)this.linkedGroups.onlinkjump.call(this,b);},dropHandler:function(a){if(this._checkLastRemaining()){this.draggables[a].resetPosition();return;}var b=this.linkedGroups.placeholder;CSS.removeClass(this.sortables[a],'drag');this.draggables[a].resetPosition();b.parentNode.insertBefore(this.sortables[a],b);b.parentNode.removeChild(b);for(var c=0;c<this.linkedGroups.length;c++)if(this.linkedGroups[c].anchor)delete this.linkedGroups[c].anchor;this.ondropcallback(a,this.sortables[a]);this.onorderchange();},getOrder:function(){var a=[],b=this.getSortables();for(var c=0;c<b.length;c++)for(var d in this.sortables)if(this.sortables[d]==b[c]){a.push(d);break;}return a;},getSortables:function(){return this.rootNode?this.rootNode.childNodes:[];},grabHandler:function(a){if(this.disabled||this._checkLastRemaining()||!this.isDraggable){this.draggables[a].killDrag();return;}this.onbeforegrabcallback(this.sortables[a],a);var b=this.linkedGroups.placeholder,c=this.sortables[a];CSS.setClass(b,c.className);CSS.addClass(b,'droppable_placeholder');CSS.addClass(c,'drag');Vector2.getElementDimensions(c).setElementDimensions(b);c.parentNode.insertBefore(b,c);this.ongrabcallback(this.sortables[a],a);if(!this.isDroppable){this.anchor=c.nextSibling;if(!this.anchor){this.anchor=$N('div');c.parentNode.appendChild(this.anchor);}}},insertPlaceholder:function(a,b,c){if(c){DOM.insertBefore(b,a);}else DOM.insertAfter(b,a);},keyExists:function(a){return this.sortables[a];},link:function(a){a.linkedGroups=this.linkedGroups;if(!this.linkedGroups.length)this.linkedGroups.push(this);this.linkedGroups.push(a);for(var b=0;b<this.linkedGroups.length;b++)if(this.linkedGroups[b].namespace!=this.namespace){this.linkedGroups[b].namespace=this.namespace;for(var c in this.linkedGroups[b].droppables){this.linkedGroups[b].droppables[c].setNamespace(this.namespace);var d=this.linkedGroups[b].draggables[c];d&&d.setNamespace(this.namespace);}}return this;},migrateLinkedSortable:function(a){for(var b=0;b<this.linkedGroups.length;b++)if(a in this.linkedGroups[b].draggables){this.sortables[a]=this.linkedGroups[b].sortables[a];this.draggables[a]=this.linkedGroups[b].draggables[a];this.draggables[a].setGrabHandler(this.grabHandler.bind(this,a)).setDropHandler(this.dropHandler.bind(this,a));this.droppables[a]=this.linkedGroups[b].droppables[a];this.droppables[a].setDragOverHandler(this._dragOverHandlerShim.bind(this,a));delete this.linkedGroups[b].sortables[a];delete this.linkedGroups[b].draggables[a];delete this.linkedGroups[b].droppables[a];return true;}return false;},removeSortable:function(a){if(a in this.sortables){if(a in this.draggables)this.draggables[a].destroy();if(a in this.droppables)this.droppables[a].destroy();delete this.draggables[a];delete this.droppables[a];delete this.sortables[a];}},setDisabled:function(a){this.disabled=a;return this;},forceDrop:function(a){if(a in this.sortables)this.draggables[a].killDrag();},setBeforeGrabCallback:function(a){this.onbeforegrabcallback=a;return this;},setBoundingBox:function(a){this.boundingBox=a;for(var b in this.draggables)this.draggables[b].setBoundingBox(this.boundingBox);return this;},setBeforeDragOverCallback:function(a){this.onbeforedragover=a;return this;},setDragOverCallback:function(a){this.ondragover=a;return this;},setDropCallback:function(a){this.ondropcallback=a;return this;},setDroppable:function(a){this.isDroppable=a;return this;},setDraggable:function(a){this.isDraggable=a;return this;},setGrabCallback:function(a){this.ongrabcallback=a;return this;},setBeforeLinkJumpHandler:function(a){this.linkedGroups.onbeforelinkjump=a;return this;},setInsertPlaceholderHandler:function(a){this.insertPlaceholder=a;},setLinkJumpHandler:function(a){this.linkedGroups.onlinkjump=a;return this;},setNeverEmpty:function(a){this.neverEmpty=a;},setOrderChangeHandler:function(a){this.onorderchange=a;return this;},setRequireSameParent:function(a,b){this.requireSameParent=b;},setSortablesGetter:function(a){this.getSortables=a;},_checkLastRemaining:function(a){var b=this.hasEmptyMessage?2:1;return this.neverEmpty&&this.getSortables().length==b;},_dragOverHandlerShim:function(a,b){this.dragOverHandler(a,b.getKey('key'));},_initializeAdded:function(a,b){if(this.rootNode===null){this.rootNode=b.parentNode;if(!this.linkedGroups.placeholder)this.linkedGroups.placeholder=$N(b.tagName,{className:'dragPlaceholder',style:{padding:'0px'}});}else if(this.requireSameParent&&this.rootNode!=b.parentNode)throw new Error('All sortables of a collection must share the same parentNode');if(a in this.draggables)throw new Error('All sortables must have a unique key');}});
function PhotoInlineOrganizer(a,b){this.root=$(a);this.url=b;this.IDLE='idle';this.PENDING='pending';this.SAVING='saving';this.UP='up';this.DOWN='down';this.state=this.IDLE;this.sortable=new SortableGroup();this.sortable.setRequireSameParent(false);this.sortable.setSortablesGetter(function(){return DOM.scry(this.root,'div.dragWrapper');}.bind(this));this.sortable.setInsertPlaceholderHandler(this.insertPlaceholder.bind(this));this.sortable.setOrderChangeHandler(this.onSave.bind(this));PhotoInlineOrganizer.cache[a]=this;PhotoInlineOrganizer.refresh(a);this.order=this.sortable.getOrder();Event.listen(this.root,'click',this.moveListener.bind(this));}PhotoInlineOrganizer.cache={};PhotoInlineOrganizer.refresh=function(a){var b=PhotoInlineOrganizer.cache[a];DOM.scry(b.root,'td').forEach(function(c){if(c.getAttribute('data-id')){var d=DOM.find(c,'div.dragWrapper'),e=DOM.find(d,'a.uiMediaThumb');b.sortable.addSortable(c.getAttribute('data-id'),d,e);c.removeAttribute('data-id');}});};copy_properties(PhotoInlineOrganizer.prototype,{getItems:function(){return DOM.scry(this.root,'div.dragWrapper').filter(function(a){return !CSS.hasClass(a,'drag');});},moveListener:function(event){var a=event.getTarget();if(CSS.hasClass(a,'arrow')){this.movePhoto(Parent.byClass(a,'dragWrapper'),CSS.hasClass(a,this.DOWN)?this.DOWN:this.UP);a.focus();return false;}},movePhoto:function(a,b){var c=DOM.scry(this.root,'td'),d=this.getItems(),e=d.indexOf(a),f=0;if(b==this.UP&&e>0){f=-1;}else if(b==this.DOWN&&e<d.length-1)f=1;if(f!==0){DOM.appendContent(c[e],d[e+f]);DOM.appendContent(c[e+f],d[e]);}this.onSave();},save:function(){if(this.state!=this.IDLE){this.state=this.PENDING;}else{this.state=this.SAVING;new AsyncRequest().setURI(this.url).setMethod('POST').setData({order:this.order}).setHandler(this.saveResponse.bind(this)).setErrorHandler(this.saveResponse.bind(this)).send();}},saveResponse:function(a){var b=this.state;this.state=this.IDLE;if(b==this.PENDING)this.save();if(a.getError())AsyncResponse.verboseErrorHandler(a);},onSave:function(){var a=this.sortable.getOrder();if(a.join('|')!=this.order.join('|')){this.order=a;this.save();}},insertPlaceholder:function(a,b,c){var d=DOM.scry(this.root,'td'),e=this.getItems(),f=e.indexOf(b),g=e.indexOf(a),h;if(f>g){for(h=g;h<f;h++)DOM.appendContent(d[h],e[h+1]);}else for(h=g-1;h>=f;h--)DOM.appendContent(d[h+1],e[h]);DOM.appendContent(d[f],a);}});
__d("legacy:randomShuffle",["randomShuffle"],function(a,b,c,d){a.randomShuffle=b('randomShuffle');},3);
EgoTranslationVote={init:function(a){Event.listen(a.controller,'click',function(b){if(b.target.nodeName=='INPUT')Form.bootstrap(a.controller);});}};
__d("FormDisableOnSubmit",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._form=i;}g(h.prototype,{_subscription:null,_disabled:false,enable:function(){this._subscription=this._form.subscribe(['submit','reset'],this._handle.bind(this));},disable:function(){this._form.unsubscribe(this._subscription);this._subscription=null;},_handle:function(i,j){if(i=='submit'){if(this._disabled)return false;this._disabled=true;return true;}this._disabled=false;}});e.exports=h;});
__d("FormSubmitOnChange",["event-extensions","copyProperties","DOM"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('DOM');function i(j){this._form=j;}g(i.prototype,{_listener:null,enable:function(){this._listener=Event.listen(this._form.getRoot(),'change',this._submit.bind(this));},disable:function(){this._listener.remove();this._listener=null;},_submit:function(){var j=this._form.getRoot(),k=h.scry(j,'input[type="submit"]')[0];if(!k){k=h.create('input',{type:'submit',className:'hidden_elem'});h.appendContent(j,k);}k.click();}});e.exports=i;});
__d("UIForm",["event-extensions","ArbiterMixin","BehaviorsMixin","Class","DOM","Form","FormDisableOnSubmit","FormSubmitOnChange","ObjectUtils","Run","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Class'),j=b('DOM'),k=b('Form'),l=b('FormDisableOnSubmit'),m=b('FormSubmitOnChange'),n=b('ObjectUtils'),o=b('Run'),p=b('copyProperties');function q(r,s,t,u){this._root=r;this.controller=r;this._message=s;o.onAfterLoad(function(){this._originalState=k.serialize(this._root);}.bind(this));this._forceDirty=t;this._submitted=false;Event.listen(this._root,'submit',this._handleSubmit.bind(this));if(u&&u.length)this.enableBehaviors(u);var v=true;o.onBeforeUnload(this.checkUnsaved.bind(this),v);}i.mixin(q,g,h,{getRoot:function(){return this._root;},setSubmitOnChange:function(r){if(r)this.enableBehavior(m);},setDisableOnSubmit:function(r){if(r)this.enableBehavior(l);},_handleSubmit:function(){if(this.inform('submit')===false)return false;this._submitted=true;return true;},reset:function(){this.inform('reset');this._submitted=false;},checkUnsaved:function(){if(!this._submitted&&j.contains(document.body,this._root)){var r=this._forceDirty;if(!r){var s=k.serialize(this._root);r=!n.areEqual(s,this._originalState);}if(r)return this._message;}return null;}});e.exports=a.UIForm||q;});
__d("legacy:uiform-js",["UIForm"],function(a,b,c,d){a.UIForm=b('UIForm');},3);
__d("ProgressiveDatepicker",["event-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","Parent","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Parent'),n=b('copyProperties');function o(){}n(o,{PERIODS:['year','month','day','hour','minute'],getInstance:function(p){return k.get(p,'datepicker');}});i.mixin(o,h,{init:function(p,q){this._root=p;this._savedLabels={};this._menus={};this._mintime=q.mintime&&new Date(1000*q.mintime);this._maxtime=q.maxtime&&new Date(1000*q.maxtime);k.set(p,'datepicker',this);l.scry(p,'select').each(function(r){Event.listen(r,'change',this._handleChange.shield(this,r));var s=m.byClass(r,'period');Event.listen(r,'focus',j.addClass.curry(s,'periodFocus'));Event.listen(r,'blur',j.removeClass.curry(s,'periodFocus'));this._setMenuSelectionState(r);if(r.getAttribute('data-name')==='month')this._updateDaysInMonth();}.bind(this));l.scry(p,'a.periodLabel').each(function(r){var s=m.byClass(r,'period');Event.listen(r,'click',function(){j.addClass(s,'periodSelected');j.addClass(s,'periodFocus');});});this.inform('initialized',this,g.BEHAVIOR_STATE);},setDate:function(p,q,r,s,t){var u=o.PERIODS;for(var v=0;v<u.length;v++)this._setValueForPeriod(u[v],arguments[v]);this._resetIfBeyondRange('year');this._updateDaysInMonth();},setDateWithTimestamp:function(p){var q=new Date(p);this.setDate(q.getFullYear(),q.getMonth()+1,q.getDate(),q.getHours(),q.getMinutes());},isSet:function(){var p=o.PERIODS;for(var q=0;q<p.length;q++)if(this._getValueForPeriod(p[q]))return true;return false;},getRoot:function(){return this._root;},getValues:function(){var p=o.PERIODS,q={};for(var r=0;r<p.length;r++){var s=this._getValueForPeriod(p[r]);if(s)q[p[r]]=s;}return q;},getDate:function(){var p=this.getValues();return new Date(p.year||0,(p.month||1)-1,p.day||1,p.hour||0,p.minute||0);},getTimestamp:function(){return Math.round(this.getDate().getTime()/1000);},_setValueForPeriod:function(p,q){var r=this._menuForPeriodName(p);if(!r)return;if(q===undefined)q='';var s=r.options;for(var t=0,u=s.length;t<u;t++)if(s[t].value==q){r.selectedIndex=t;break;}this._setMenuSelectionState(r);},_getValueForPeriod:function(p){var q=this._menuForPeriodName(p);return (q&&q.options[q.selectedIndex].value);},_handleChange:function(p){this._setMenuSelectionState(p);this._resetIfBeyondRange(p.getAttribute('data-name'));this._updateDaysInMonth();this.inform('changed');},_setMenuSelectionState:function(p){var q=m.byClass(p,'period');if(!q)return;if(j.hasClass(q,'periodRequired')){if(p.selectedIndex===0)p.selectedIndex=1;}else this._updateLabel(p);var r=p.getAttribute('data-name'),s=p.options[p.selectedIndex].value;j.conditionClass(q,'periodSelected',s);j.conditionClass(this._root,this._selectedClass(r),s);if(!s)this._resetMenu(o.PERIODS.indexOf(r)+1);},_resetIfBeyondRange:function(p){var q=false,r=this.getValues(),s;if(this._maxtime){s=this.getDate();q=s>this._maxtime;}if(!q&&this._mintime){var t=r.year||9001,u=(r.month||12)-1,v=new Date(t,u,0).getDate();s=new Date(t,u,r.day||v,r.hour||23,r.minute||0);q=s<this._mintime;}if(q)this._resetMenu(o.PERIODS.indexOf(p));},_updateDaysInMonth:function(){var p=this._menuForPeriodName('day');if(!p)return;if(this._savedDays){while(this._savedDays.length)l.appendContent(p,this._savedDays.shift());}else this._savedDays=[];var q=p.options.length,r=this._daysInMonth()+1,s;while((s=p.options[r])&&(s.value<q)){s.selected=false;l.remove(s);this._savedDays.push(s);}this._setMenuSelectionState(p);},_updateLabel:function(p){var q=p.getAttribute('data-name'),r=p.options[0];if(!this._savedLabels[q])this._savedLabels[q]=l.getText(r);if(p.selectedIndex===0){l.setContent(r,this._savedLabels[q]);}else l.setContent(r,'--');},_daysInMonth:function(){return new Date(this._getValueForPeriod('year')||1999,this._getValueForPeriod('month')||1,0).getDate();},_menuForPeriodName:function(p){if(!this._menus[p])this._menus[p]=l.scry(this._root,'.'+p+'Menu')[0];return this._menus[p];},_selectedClass:function(p){return 'uiProgressiveDatepickerSelected-'+p;},_resetMenu:function(p){var q=o.PERIODS;for(;p<q.length;p++){var r=q[p],s=this._menuForPeriodName(r);if(!s)return;if(m.byClass(s,'periodRequired')){s.selectedIndex=1;}else{j.removeClass(m.byClass(s,'period'),'periodSelected');j.removeClass(this._root,this._selectedClass(r));s.selectedIndex=0;this._updateLabel(s);}}}});e.exports=o;});